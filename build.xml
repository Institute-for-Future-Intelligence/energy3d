<?xml version="1.0" encoding="UTF-8"?>
<project name="Energy3D" default="default" basedir="." xmlns:fx="javafx:com.sun.javafx.tools.ant">
	<property name="JAVA_HOME" value="C:\Program Files\Java\jdk1.8.0_45\" />
	<property name="build.src.dir" value="src" />
	<property name="build.classes.dir" value="classes" />
	<property name="build.dist.dir" value="dist" />
	
	<condition property="os" value="windows-${os.arch}">
		<os family="windows"/>
	</condition>
	<condition property="os" value="macosx-universal">
		<os family="mac"/>
	</condition>
	<condition property="os" value="linux-${os.arch}">
		<os family="unix"/>
	</condition>
	
    <echo message="OS Name is:         ${os}" />
    <echo message="OS Architecture is: ${os.arch}" />
    <echo message="OS Version is:      ${os.version}" />
	
	<path id="CLASSPATH">
		<fileset dir="exe">
			<patternset id="jars.no.source">
				<include name="*.jar" />
				<include name="ardor3d/*.jar" />
				<include name="poly2tri/*.jar" />
				<exclude name="**/*-sources*"/>
				<include name="jogl/jogl-all.jar" />
				<include name="jogl/gluegen-rt.jar" />
				<include name="jogl/*natives-${os}.jar" />				
			</patternset>
		</fileset>
		<pathelement path="${build.classes.dir}" />
	</path>
	
	<target name="default" depends="clean,compile,deploy"></target>

	<target name="deploy">		
		<taskdef resource="com/sun/javafx/tools/ant/antlib.xml" uri="javafx:com.sun.javafx.tools.ant" classpath=".:${JAVA_HOME}/lib/ant-javafx.jar" />

		<fx:application id="app" name="Energy3D" mainClass="org.concord.energy3d.MainApplication" />

		<fx:jar destfile="exe/energy3d.jar">
			<fx:application refid="app" />
			<fx:resources>
				<fileset dir="exe">
					<patternset refid="jars.no.source"/>
				</fileset>				
			</fx:resources>	
			<fileset dir="${build.classes.dir}" />
		</fx:jar>
		
		<taskdef name="digest" classname="com.threerings.getdown.tools.DigesterTask" classpath="exe/getdown-1.4.jar"/>
		<digest appdir="exe"/>
		
		<fx:resources id="exe.resources">
			<fx:fileset dir="${build.dist.dir}" includes="energy3d.jar" />
			<fileset dir="exe">
				<patternset refid="jars.no.source"/>
				<include name="getdown.txt" />
				<include name="digest.txt" />
			</fileset>
		</fx:resources>		
		
		<fx:deploy outdir="${build.dist.dir}" outfile="energy3d" nativeBundles="exe" verbose="false">
			<fx:application refId="app" />
			<fx:info title="Energy3D" vendor="Concord Consortium Inc." />
			<fx:preferences shortcut="true" install="false" menu="true"/>
			<fx:platform basedir="${JAVA_HOME}"/>
			<fx:resources refId="exe.resources" />
		</fx:deploy>			
	</target>

	<target name="clean">
		<mkdir dir="${build.classes.dir}" />
		<mkdir dir="${build.dist.dir}" />
		<delete>
			<fileset dir="${build.classes.dir}" includes="**/*" />
			<fileset dir="${build.dist.dir}" includes="**/*" />
		</delete>
	</target>

	<target name="compile" depends="clean">
		<javac includeantruntime="false" srcdir="${build.src.dir}" destdir="${build.classes.dir}" fork="yes" executable="${JAVA_HOME}/bin/javac" source="1.8" debug="on" classpathref="CLASSPATH">
		</javac>

		<!-- Copy resources to build.classes.dir -->
		<copy todir="${build.classes.dir}">
			<fileset dir="src/main/resources" />
		</copy>
	</target>
	
</project>